(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{Acox:function(e,t,i){"use strict";i.r(t);var o=i("pVnL"),n=i.n(o),s=i("gcR/"),a=i.n(s),r=i("lSNA"),l=i.n(r),c=(i("3bBZ"),i("q1tI")),d=i.n(c),h=i("ikHm"),u=i("y6Dp"),m=i("mF3+"),p=i("wpmu"),b=i("G4cA"),g=i("g4rC"),y=i("6WtK"),v=i("i3uR"),S=i("wldR"),f=i("LUuO"),k=i("wZk+"),M=i("stZG"),T=i("MvRd"),C=i("C7oc"),w=i("nM47"),A=i("FcJC"),x=i("6rsX"),B=i("TmDR"),I=i("uUOz"),P=i("Wae9"),R=i("MeYt"),O=i("7M94"),F=i("AXh+"),D=i("d9nj"),j=i("ETM2"),N=i("4aFz"),U=i("QcDD"),q=i("SAEH"),L=i("Sb6f"),V=i("G414"),_=i("Oy36"),E=i("OxuQ"),W=i("HSWF"),z=i("id5p"),G=i("zmp8"),Q=i("H4VD"),Z=i("/0g+"),H=i("MBf9"),J=i("h5Kq"),K=i("HRSx"),X=i("ov3o"),Y=i("58VE"),$=i("HTHG"),ee=i("UcZb"),te=i("Rtjx"),ie=i("JBsN"),oe=i("J9+s"),ne=i("Hq/H"),se=i("wS9/"),ae=i("qX+M"),re=i("bLTx"),le=i("gHFd"),ce=i("DNgp"),de=i("unoy"),he=i("heK1"),ue=i("w5u6");class me extends S.a{constructor(...e){super(...e),l()(this,"storeTypes",{shareButtonPopupStore:g.a}),l()(this,"handleOpenQuickFind",()=>{N.b({environment:this.environment,analyticsFrom:"public-page-topbar"})}),l()(this,"handleShareClick",()=>{u.rd(this.environment),w.e(this.environment)}),l()(this,"handleTopbarClick",()=>{x.e(this.environment)}),l()(this,"navigateToFirstSpace",()=>{const{currentUserRootStore:e,currentUserSettingsStore:t}=U.default.state;e&&t&&q.p({environment:this.environment,userRootStore:e,userSettingsStore:t})}),l()(this,"handleMoveToClick",e=>{V.d({blocks:[this.props.store],analyticsFrom:"quick_add",onAccept:this.handleMoveToAccept,isAddTo:!0})}),l()(this,"handleMoveToAccept",e=>{const{currentSpaceStore:t}=U.default.state;t&&this.props.saveParent&&W.A({currentUserId:this.environment.currentUser.id,spaceId:t.id,value:e}),u.Fc(this.environment)}),l()(this,"handleCancelQuickAdd",e=>{const t=U.default.state.currentBlockStore,i=X.a.state.lastPageId;t&&i&&(Q.navigateToBlock({environment:this.environment,store:p.a.createChildStore(t,{table:K.a,id:i}),showMoveTo:!1,saveParent:!1}),H.createAndCommit(this.environment,e=>{Z.b({environment:this.environment,blocks:[t],transaction:e})}))})}renderComponent(){const{store:e}=this.props,{WindowSizeStore:t,device:i}=this.environment,o=Object(F.g)(this.environment,this.props.store);return a()(M.a,{capture:!0,render:s=>d.a.createElement("div",n()({},s,{style:this.getWrapStyle()}),o?this.renderPublicPageTopbar():this.renderNormalTopbar(),e.canEdit()&&i.isPhone&&a()(B.a,{store:this.props.store,isMobile:!0},this.props.store.id),this.props.isOffline&&a()(J.b,{type:J.a.White,isMobile:!0},void 0,a()("div",{style:{display:"flex",alignItems:"center",width:"100%",paddingLeft:t.getSafePaddingLeftCSS(10),paddingRight:t.getSafePaddingRightCSS(14)}},void 0,m.a.mobileOffline({width:26,marginRight:12}),a()("div",{},void 0,a()(oe.FormattedMessage,{defaultMessage:"You're offline",id:"topbarMobile.offline.message"})))),a()(f.a,{banners:this.props.banners,isMobile:!0}))})}renderPublicPageTopbar(){const{store:e}=this.props;return a()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:O.Qb},void 0,this.environment.currentUser.isLoggedIn()&&a()(c.Fragment,{},void 0,a()(R.a,{style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:14,paddingRight:14,fontWeight:L.a.fontWeight.medium,color:this.theme.regularTextColor},mobileFeedback:!0,onClick:this.navigateToFirstSpace},void 0,a()(oe.FormattedMessage,{defaultMessage:"Back",id:"topbarMobile.backButton.label"})),a()("div",{style:{height:18,width:1,flexShrink:0,marginRight:6,background:this.theme.darkDividerColor}})),a()(y.a,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:1,showCurrentPageControls:!1,ancestorMaxWidth:100,currentPageMaxWidth:220,isMobile:!0}),a()("div",{style:{flexGrow:1,flexShrink:1}}),a()(D.a,{onClick:this.handleOpenQuickFind},void 0,m.a.searchThick({width:20,height:20})),a()(j.a,{store:e,buttonPopupStore:I.a}))}renderNormalTopbar(){const{store:e,pageVisitStore:t,presenceStore:i}=this.props,{isTablet:o}=this.environment.device,n=this.props.isInvalidPage;return a()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:O.Qb},void 0,this.renderHamburgerButton(),o&&a()(ne.a,{}),!n&&this.renderBreadcrumbs(),e.canEdit()&&o&&a()(B.a,{store:e,isMobile:!1},e.id),a()(T.a,{}),e.isRestricted()&&a()(re.a,{style:{marginRight:8},onClick:()=>{this.stores.shareButtonPopupStore.setState({open:!0})}}),o&&e.canEdit()&&t&&i&&a()(ie.a,{rootStore:e,pageVisitStore:t,presenceStore:i}),this.props.shouldShowMoveTo?this.renderCancelQuickAdd():this.renderRightButtons())}renderHamburgerButton(){const e=P.a.getUnreadMentionsCountForOtherSpaces();return a()(R.a,{mobileFeedback:!0,style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,height:"100%",width:36,marginLeft:4},onClick:()=>{if(Object(te.a)(this.environment))A.setExpand({environment:this.environment,isExpanded:!ee.a.get()});else{const{NativeMobileActionBarStore:e}=this.environment,t=e?e.state.menuType:null;"editing"===ce.default.state.mode||null!==t?(de.f(this.environment),null==e||e.clear(!1),he.b.onHide(()=>{ue.default.afterNextFlush(()=>A.open())})):A.open()}u.ld(this.environment)}},void 0,m.a.hamburgerMenu({width:18,height:18}),a()(C.a,{color:C.a.Color.Red,count:e,style:{position:"absolute",top:9,right:1}}))}renderBreadcrumbs(){const{isTablet:e}=this.environment.device;return this.props.shouldShowMoveTo?this.renderMoveTo():a()(y.a,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:e?2:1,showCurrentPageControls:!1,ancestorMaxWidth:e?160:100,currentPageMaxWidth:e?240:220,isMobile:!0})}renderMoveTo(){const{store:e}=this.props,t=e.getParentStore(),{currentSpaceStore:i}=U.default.state,o=t instanceof b.a&&i&&t.id===i.id;if(t){if(o)return a()(R.a,{mobileFeedback:!0,style:me.moveToButtonStyle,onClick:this.handleMoveToClick},void 0,a()(oe.FormattedMessage,{defaultMessage:"<mediumcolor>Add to</mediumcolor>{userAvatar}<mediumweight>Private pages</mediumweight>",id:"topbarMobile.addToPrivateSectionButton.label",values:{mediumcolor:(...e)=>a()("span",{style:{color:this.theme.mediumTextColor,marginRight:8}},void 0,e),mediumweight:(...e)=>a()("span",{style:{fontWeight:L.a.fontWeight.medium,marginLeft:4}},void 0,e),userAvatar:a()(Y.a,{size:22,avatarShouldShowShadow:!0,userValue:Object($.h)(this.environment)})}}),this.renderChevron());{const i=e instanceof b.a?Object(ae.getSpaceIcon)(this.environment,e):e.getIcon();return a()(R.a,{mobileFeedback:!0,style:me.moveToButtonStyle,onClick:this.handleMoveToClick},void 0,a()("span",{style:{color:this.theme.mediumTextColor}},void 0,a()(oe.FormattedMessage,{defaultMessage:"Add to",id:"topbarMobile.addToPageOrWorkspaceSectionButton.label",description:"Displayed to the user in front of a page or space, like 'Add to Page', where 'Page' is an existing page."})," "),a()(_.a,{disabled:!0,icon:i,isEmptyPage:t.table===K.a&&t.isEmptyPage(),title:t instanceof b.a?Object(ae.getSpaceName)(this.environment,t):void 0,size:24,style:{marginLeft:8,marginRight:4}}),a()(E.a,{style:{fontWeight:L.a.fontWeight.semibold},store:t}),this.renderChevron())}}}renderChevron(){return m.a.chevronDown({marginLeft:4,width:10,fill:this.theme.lightTextColor})}renderRightButtons(){const{device:e}=this.environment;if(!this.props.isInvalidPage)return e.isMobileNative?a()(c.Fragment,{},void 0,this.renderShare(),this.renderShowMore()):a()(c.Fragment,{},void 0,this.renderShowMore(),this.renderShare(),this.renderUpdatesButton())}renderCancelQuickAdd(){return a()(R.a,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:16,paddingRight:16,fontWeight:L.a.fontWeight.medium,color:G.g.blue},onClick:this.handleCancelQuickAdd},void 0,a()(oe.FormattedMessage,{defaultMessage:"Cancel",id:"topbarMobile.cancelQuickAddButton.label"}))}renderShowMore(){return a()(k.a,{store:this.props.store,collectionViewStore:this.props.collectionViewStore,buttonPopupStore:I.a})}renderShare(){const{device:e}=this.environment;return a()(v.a,{popupType:e.isMobile?v.a.PopupType.SlideUp:v.a.PopupType.Popup,style:{width:460},buttonPopupStore:this.stores.shareButtonPopupStore,onClick:this.handleShareClick,renderOrigin:t=>d.a.createElement(R.a,n()({mobileFeedback:!0,style:me.actionButtonStyle},t),e.isAndroid?m.a.androidShare({width:16,height:16}):m.a.iOSShare({width:26})),render:()=>a()(le.LazyBlockPermissionsSettings,{buttonPopupStore:this.stores.shareButtonPopupStore,store:this.props.store,onClose:()=>{this.stores.shareButtonPopupStore.setState({...this.stores.shareButtonPopupStore.state,open:!1})}})})}renderUpdatesButton(){return a()(z.a,{format:z.a.Format.TopbarMobile})}getWrapStyle(){return{width:"100%",maxWidth:"100vw",zIndex:h.w}}getStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",maxWidth:"100vw",height:se.b,marginTop:e.state.paddingTopCSS,paddingLeft:e.getSafePaddingLeftCSS(0),paddingRight:this.props.shouldShowMoveTo?e.getSafePaddingRightCSS(0):e.getSafePaddingRightCSS(7),boxShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:this.theme.contentBackground,transition:"box-shadow 300ms",WebkitUserSelect:"none",cursor:"pointer"}}getBreadcrumbsStyle(){const{isTablet:e}=this.environment.device;return{flexGrow:0,marginLeft:2,overflow:"auto",WebkitOverflowScrolling:"touch",marginRight:e?16:8,height:"100%"}}}l()(me,"actionButtonStyle",{display:"flex",alignItems:"center",height:"100%",paddingLeft:6,paddingRight:6}),l()(me,"moveToButtonStyle",{display:"flex",alignItems:"center",paddingLeft:8,paddingRight:12,fontSize:L.a.fontSize.UIRegular.mobile,lineHeight:L.a.lineHeight.UIRegular.mobile,whiteSpace:"nowrap",minWidth:0}),t.default=me},HTFi:function(e,t,i){"use strict";var o=i("LqYT"),n=i("heK1"),s=i("5qTp");t.a=new o.a(()=>{const{phase:e}=n.b.state;if(s.default.state.open)return!0;return e===n.a.hidden||e===n.a.willHide})},OeJx:function(e,t,i){"use strict";i.r(t);var o=i("gcR/"),n=i.n(o),s=i("lSNA"),a=i.n(s),r=(i("3bBZ"),i("q1tI")),l=i.n(r),c=i("yNyh"),d=i("G4GV"),h=i("wldR"),u=i("mF3+"),m=i("6rsX"),p=i("unoy"),b=i("D8Ld"),g=i("stZG"),y=i("rGsA"),v=i("J9+s");class S extends h.a{constructor(...e){super(...e),a()(this,"storeTypes",{store:d.a}),a()(this,"handleFocused",()=>{m.e(this.environment),p.f(this.environment),this.stores.store.setState({...this.stores.store.state,focus:!0})}),a()(this,"handleBlurred",()=>{this.stores.store.setState({...this.stores.store.state,focus:!1})}),a()(this,"handleSearchQueryChange",e=>{this.props.onChange({searchQuery:e.target.value})})}renderComponent(){const{searchQuery:e,intl:t}=this.props,{focus:i}=this.stores.store.state;return n()(b.a,{capture:i},void 0,n()(g.a,{capture:!0,render:o=>l.a.createElement("div",o,n()(c.b,{style:this.getStyle(),format:c.a.Transparent,value:e,placeholder:t.formatMessage({defaultMessage:"Type to search…",id:"database.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onFocus:this.handleFocused,onBlur:this.handleBlurred,showClearButton:!0,left:u.a.searchThick(this.getSearchIconStyle())}),n()(y.a,{show:i}))}))}getStyle(){return{boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,flexGrow:0,flexShrink:0,height:32,paddingLeft:8,paddingRight:12,borderRadius:3,fontSize:14,marginBottom:4}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}t.default=Object(v.injectIntl)(S)},QvPY:function(e,t,i){"use strict";i.r(t);var o=i("gcR/"),n=i.n(o),s=i("lSNA"),a=i.n(s),r=(i("3bBZ"),i("q1tI")),l=i.n(r),c=i("wldR"),d=i("QtqF"),h=i("4aFz"),u=i("8fuX"),m=i("UJva"),p=i("OIKt"),b=i("b936"),g=i("zK7c"),y=i("X6Ne"),v=i("pVnL"),S=i.n(v),f=i("i3uR"),k=i("5XPD"),M=i("Na01"),T=i("mF3+"),C=i("gbGO"),w=i("ohKz"),A=i("MeYt"),x=i("ty0h"),B=i("ibYI"),I=i("vJXr"),P=i("2A6Q"),R=i("pqiZ"),O=i("aEEb"),F=i("VoJ/"),D=i("CSYU"),j=i("wlCD"),N=i("QcDD"),U=i("qKs6"),q=i("J9+s"),L=i("r8MX"),V=i("Cycz"),_=i("2ZkR"),E=i("8Gp+"),W=i("rQb/"),z=i("IoOo");class G extends c.a{constructor(...e){super(...e),a()(this,"storeTypes",{passwordRequestStore:D.a}),a()(this,"handleClose",()=>{w.a.setState({open:!1})}),a()(this,"handleStartOfWeekToggle",()=>{1===this.getStartDayOfWeek()?Object(U.e)(this.environment):Object(U.d)(this.environment)})}renderComponent(){const{device:e}=this.environment,{data:t}=L.default.state,i=w.a.state.open,o="on"===_.default.getGroup(this.environment,"user-data-consent"),s=e.isIOS&&V.y(t);return n()(f.a,{popupType:e.isMobile?f.a.PopupType.SlideUp:f.a.PopupType.Popup,buttonPopupStore:w.a,renderOrigin:e=>l.a.createElement(A.a,S()({mobileFeedback:this.props.isMobile},e),n()(M.a,{left:this.renderIcon(),style:{background:i?this.theme.buttonHoveredBackground:"none"},isMobile:this.props.isMobile,disableMobileBorder:!0},void 0,n()(q.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.label"}))),render:()=>{let i;if(i=e.isMobile?{menuType:C.b.MenuType.Modal,title:n()(q.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.title"}),right:n()(q.FormattedMessage,{defaultMessage:"Done",id:"notificationSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose,whiteBackground:!0}:{menuType:C.b.MenuType.Popup},I.a.state.online){const{passwordRequestStore:e}=this.stores;return l.a.createElement(C.b,i,e.state.loading?n()(j.a,{style:{margin:"50% auto"}}):n()(P.a,{disableScroller:!0},void 0,n()(k.a,{}),n()(R.a,{size:48,isHidden:!0}),n()(W.a,{divider:"full"},void 0,n()(q.FormattedMessage,{id:"notificationSettingsButton.generalSection.title",defaultMessage:"General"})),n()(F.a,{requestStore:e,isEducationPlan:V.x(t)}),this.renderAppearanceSettings(),s&&this.renderSubscriptionSettings(),o&&this.renderUserDataConsentSettings(),n()(R.a,{size:32}),n()(B.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:this.getStartDayOfWeek()||0})))}return n()(P.a,{},void 0,n()(O.a,{isSmall:!0,style:{textAlign:"center"}},void 0,n()(q.FormattedMessage,{defaultMessage:"Please go online to manage settings.",id:"notificationSettingsButton.goOnline.prompt"})))}})}renderUserDataConsentSettings(){return n()(l.a.Fragment,{},void 0,n()(R.a,{size:32}),n()(E.a,{}))}renderAppearanceSettings(){return n()(l.a.Fragment,{},void 0,n()(R.a,{size:32}),n()(x.a,{}))}renderSubscriptionSettings(){return n()(l.a.Fragment,{},void 0,n()(R.a,{size:32}),n()(z.a,{}))}renderIcon(){return T.a.sidebarSettings({fill:this.theme.mediumIconColor,width:16})}getStartDayOfWeek(){const{currentUserSettingsStore:e}=N.default.state;if(e){const t=e.getSettings();if(t)return t.start_day_of_week}}}var Q=G,Z=i("5ma9"),H=i("y6Dp");class J extends c.a{renderComponent(){const e=n()(q.FormattedMessage,{defaultMessage:"Upgrade to Pro",id:"upgradeMobileButton.upgradeButton.label"});return n()(A.a,{mobileFeedback:!0,onClick:this.showUpgradeModal(this.environment)},void 0,n()(M.a,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},void 0,e))}renderIcon(){return T.a.settingsUpgradeFilled({fill:this.theme.mediumIconColor,width:16})}showUpgradeModal(e){return()=>{Object(H.K)(e,{from:"mobile_sidebar",for_subscription_tier:"personal"});const{mobileNative:t}=e;t&&t.openUpgradeModal(Object(Z.a)())}}}var K=J,X=i("g4rC"),Y=i("3wHm");class $ extends c.a{constructor(...e){super(...e),a()(this,"storeTypes",{buttonPopupStore:X.a}),a()(this,"handleClose",()=>{this.stores.buttonPopupStore.setState({open:!1})})}renderComponent(){if(!V.O(this.environment))return;const{store:e}=this.props,{buttonPopupStore:t}=this.stores;return n()(f.a,{buttonPopupStore:t,popupType:f.a.PopupType.SlideUp,renderOrigin:e=>l.a.createElement(A.a,S()({mobileFeedback:!0},e),n()(M.a,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},void 0,n()(q.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileSidebar.label"}))),render:()=>{if(I.a.state.online){const t={menuType:C.b.MenuType.Modal,title:n()(q.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileMemberSettings.title"}),right:n()(q.FormattedMessage,{defaultMessage:"Done",id:"memberSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose};return l.a.createElement(C.b,t,n()(Y.a,{store:e,isMobile:!0}))}this.renderOffline()}})}renderIcon(){return T.a.teamSize({fill:this.theme.mediumIconColor,width:16})}renderOffline(){return n()(P.a,{},void 0,n()(O.a,{isSmall:!0,style:{textAlign:"center"}},void 0,n()(q.FormattedMessage,{defaultMessage:"Please go online to manage members.",id:"memberSettingsButton.goOnline.prompt"})))}}var ee=$,te=i("FcJC"),ie=i("VyA+"),oe=i("yjqD"),ne=i("6rsX"),se=i("UcZb"),ae=i("0zNc"),re=i("84+D"),le=i("7M94"),ce=i("Rtjx");class de extends c.a{constructor(...e){super(...e),a()(this,"handleTouchStart",e=>{const t={x:e.touches[0].clientX,y:e.touches[0].clientY};se.c.state?t.x>Object(ce.d)(this.environment)?re.a.setState({touching:!0,swiping:!1,start:t}):this.handleReset():Object(ce.i)(this.environment)&&t.x<100?re.a.setState({touching:!0,swiping:!1,start:t}):this.handleReset()}),a()(this,"handleTouchMove",e=>{if(ae.a.state.isDragging)return void this.handleReset();const t=re.a.state;if(!t.touching)return;const i={x:e.touches[0].clientX,y:e.touches[0].clientY};if(t.swiping)re.a.setState({touching:!0,swiping:!0,start:t.start,speed:se.c.state?t.end.x-i.x:i.x-t.end.x,end:i});else{if(Math.abs(i.y-t.start.y)>=25)return void this.handleReset();(!se.c.state&&i.x-t.start.x>25||se.c.state&&t.start.x-i.x>25)&&re.a.setState({touching:!0,swiping:!0,start:t.start,speed:0,end:i})}this.updateTransform()}),a()(this,"handleTouchEnd",async()=>{const{ThemeStore:e}=this.environment,t=re.a.state;if(!t.swiping)return;const i=Object(ce.d)(this.environment),o=document.querySelector(Object(ce.i)(this.environment)?".".concat(le.Cb):".".concat(le.D)),n=document.querySelector(".".concat(le.D)),s=Math.abs(t.speed)>=8,a=s?"ease-out":"ease-in-out",r="dark"===e.state.mode?", 1px 0 0 ".concat(this.theme.shadowColor.alpha(2*this.theme.shadowOpacity).css()):"",l="\n\t\t\t".concat(this.theme.mediumBoxShadow,"\n\t\t\t").concat(r,"\n\t\t");if(se.c.state){const e=t.start.x-t.end.x;if(e+25*t.speed>i/2){let t=s?(i-e)/i*200:200;t=Math.max(t,1),o.style.transition="transform ".concat(t,"ms ").concat(a),o.style.transform="translateZ(0)translateX(0px)",Object(ce.i)(this.environment)&&(o.style.boxShadow=l,n.style.transition="filter ".concat(t,"ms ").concat(a),n.style.filter="brightness(1)"),await ue(o),te.close(),this.handleReset()}else o.style.transition="transform ".concat(200,"ms ").concat(a),o.style.transform="translateZ(0)translateX(".concat(i,"px)"),Object(ce.i)(this.environment)&&(o.style.boxShadow=l,n.style.transition="filter ".concat(200,"ms ").concat(a),n.style.filter="brightness(0.7)"),await ue(o),this.handleReset()}else{const e=t.end.x-t.start.x;if(e+25*t.speed>i/2){let t=s?(i-e)/i*200:200;t=Math.max(t,1),o.style.transition="transform ".concat(t,"ms ").concat(a),o.style.transform="translateZ(0)translateX(".concat(i,"px)"),Object(ce.i)(this.environment)&&(o.style.boxShadow=l,n.style.transition="filter ".concat(t,"ms ").concat(a),n.style.filter="brightness(0.7)"),await ue(o),te.open(),this.handleReset()}else o.style.transition="transform ".concat(200,"ms ").concat(a),o.style.transform="translateZ(0)translateX(0px)",Object(ce.i)(this.environment)&&(o.style.boxShadow=l,n.style.transition="filter ".concat(200,"ms ").concat(a),n.style.filter="brightness(1)"),await ue(o),this.handleReset()}}),a()(this,"handleSidebarToggle",()=>{this.updateTransform()}),a()(this,"updateTransform",()=>{const e=document.querySelector(Object(ce.i)(this.environment)?".".concat(le.Cb):".".concat(le.D)),t=document.querySelector(".".concat(le.D)),i=Object(ce.d)(this.environment),o=re.a.state;if(o.swiping)if(se.c.state){const n=i-(o.start.x-o.end.x)+25,s=Math.min(Math.max(0,n),i);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(s,"px)"),Object(ce.i)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const o=(1-.3*s/i).toString();t.style.filter="brightness(".concat(o,")")}}else{const n=o.end.x-o.start.x-25,s=Math.min(Math.max(0,n),i);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(s,"px)"),Object(ce.i)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const o=(1-.3*s/i).toString();t.style.filter="brightness(".concat(o,")")}}else se.c.state?(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(".concat(i,"px)"),Object(ce.i)(this.environment)&&(e.style.transform="translateZ(0)translateX(calc(".concat(i,"px - 1px))"),e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="filter 200ms",t.style.filter="brightness(0.7)"),ne.e(this.environment)):(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(0)",Object(ce.i)(this.environment)&&(e.style.boxShadow="none",t.style.transition="filter 200ms",t.style.filter="brightness(1)"))})}didMount(){const{device:e}=this.environment;e.isMobile&&(window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd),se.c.addListener(this.handleSidebarToggle))}willUnmount(){const{device:e}=this.environment;e.isMobile&&(window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),se.c.removeListener(this.handleSidebarToggle))}handleReset(){re.a.reset(),this.updateTransform()}}var he=de;async function ue(e){const t=oe.c();e.addEventListener("transitionend",t.resolve),e.addEventListener("webkitTransitionEnd",t.resolve),await t.promise,e.removeEventListener("transitionend",t.resolve),e.removeEventListener("webkitTransitionEnd",t.resolve)}var me=i("GRWW"),pe=i("p0Uu"),be=i("zmp8"),ge=i("HTHG"),ye=i("NOLh"),ve=i("wS9/"),Se=i("ij+4"),fe=i("jzfh"),ke=i("1G+a"),Me=i("A9TN"),Te=i("SAEH");class Ce extends c.a{constructor(...e){super(...e),a()(this,"sidebarState",this.createComputedStore(()=>Object(ge.j)(this.environment))),a()(this,"storeTypes",{scrollerStore:me.a}),a()(this,"handleScrollerMount",e=>{pe.a.SidebarMobileScroller=e}),a()(this,"handleCloseSidebar",()=>{te.close()}),a()(this,"handleClickFind",()=>h.c({environment:this.environment,analyticsFrom:"sidebar-mobile"})),a()(this,"handleOrientationChange",()=>{te.close()}),a()(this,"isScrolledToTop",this.createComputedStore(()=>0===this.stores.scrollerStore.state.scrollTop)),a()(this,"isCurrentIAPSubscriber",()=>{const{currentUserRootStore:e}=N.default.state,t=Object(V.b)({environment:this.environment,userRootStore:e});return!(!t||!t.includes(Me.default.revenueCat.productIDs.personal.monthly)&&!t.includes(Me.default.revenueCat.productIDs.personal.yearly))})}willMount(){window.addEventListener("resize",this.handleOrientationChange)}willUnmount(){window.removeEventListener("resize",this.handleOrientationChange)}renderComponent(){const e=ce.a(this.environment);return e?n()(ye.a,{render:()=>n()("div",{className:le.Cb,style:this.getWrapStyle()},void 0,!e&&n()(he,{}),this.renderSidebar()),isVisible:!0,animationStyle:{width:e?ce.b(this.environment):"100vw"}}):n()("div",{className:le.Cb,style:{...this.getWrapStyle(),width:"100vw"}},void 0,!e&&n()(he,{}),this.renderSidebar())}renderSidebar(){return n()(ie.a,{capture:!ce.a(this.environment)&&se.c.get(),onBackButton:this.handleCloseSidebar},void 0,n()("div",{style:this.getStyle()},void 0,this.renderTopbar(),this.renderOutliner()))}renderTopbar(){const{device:e}=this.environment,t=e.isMobileNative&&e.isTablet&&ce.a(this.environment);return n()("div",{style:this.getTopbarStyle()},void 0,n()(Se.c,{shouldShowUnexpandButton:t,format:Se.a.Mobile,onSpaceClick:async({event:e,spaceViewStore:t})=>{await Te.q({environment:this.environment,spaceViewStore:t,userSettingsStore:N.default.state.currentUserSettingsStore,userRootStore:N.default.state.currentUserRootStore,metaClick:e.ctrlKey||e.metaKey})}}),!e.isMobileNative&&n()(A.a,{onClick:this.handleClickFind,mobileFeedback:!0,style:Ce.actionButtonStyle},void 0,T.a.mobileBottomBarSearch({width:26})))}renderOutliner(){const{currentSpaceStore:e,currentSpaceViewStore:t,currentUserRootStore:i,currentUserStore:o,currentUserSettingsStore:s,currentBlockStore:a}=N.default.state,r=this.sidebarState.state;if(!(r&&a&&t&&i&&e&&o&&s))return;const c=e.canEdit(),h=Object(ke.b)({environment:this.environment})&&"personal_free"===Object(V.h)(this.environment)&&L.default.state.data&&"unsubscribed_admin"===L.default.state.data.type&&L.default.state.data.revenueCatEnabled&&!this.isCurrentIAPSubscriber();return n()(g.a,{store:e,disableEditNearestBlock:!0,render:i=>l.a.createElement(u.b,{store:this.stores.scrollerStore,ref:this.handleScrollerMount,style:Ce.outlinerStyle,disableScroll:y.e(this.environment),type:u.a.Y},r.showBookmarksSection&&n()(p.a,{isMobile:!0,type:"bookmarks",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>n()(d.a,{isMobile:!0,type:"bookmarks",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getBookmarkedPagesStore(),childStores:t.getBookmarkedPages(),showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c})}),r.showWorkspaceSection&&n()(p.a,{isMobile:!0,type:"workspace",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>n()(d.a,{isMobile:!0,type:"workspace",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getWorkspacePages(),addPageTitle:n()(q.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addPageToWorkspace.title"}),onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,showAddPageButton:!0,disabled:!c})}),r.showSharedSection&&n()(p.a,{isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:i=>l.a.createElement(l.a.Fragment,null,n()(d.a,{isMobile:!0,type:"shared",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getSharedPagesStore(),childStores:r.visibleSharedPagesStores,showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c}),this.isEnhancedSidebarEnabled&&r.showSharedOverflowButton&&n()(fe.a,{originRef:i,isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,userSettingsStore:s,allSharedPages:r.allSharedPagesStores,visiblePageIds:r.visibleSharedPagesStores.map(({id:e})=>e)}))}),r.showPrivateSection&&!r.showOnlyPrivateSection&&n()(p.a,{isMobile:!0,type:"private",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>n()(d.a,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(this.environment),addPageTitle:n()(q.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addAPrivatePage.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c})}),r.showOnlyPrivateSection&&n()(d.a,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(this.environment),addPageTitle:n()(q.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addAPageToOnlyPrivateSection.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c}),r.showOnlyPrivateSection&&n()("div",{style:{height:20}}),n()(ee,{store:e}),n()(Q,{isMobile:!0}),e.canEdit()&&n()(b.a,{store:a,isMobile:!0}),h&&n()(K,{}),n()(m.a,{isMobile:!0}),n()("div",{style:{height:128}}))})}get isEnhancedSidebarEnabled(){return"on"===_.default.getGroup(this.environment,"sidebar-enhancements")}getWrapStyle(){return ce.a(this.environment)?{display:"block",height:"100vh",position:"relative",zIndex:3}:ce.i(this.environment)?{display:"block",height:"100vh",position:"fixed",top:0,right:"100%",zIndex:3}:{display:"block",height:"100vh",position:"fixed",top:0,left:0}}getStyle(){return{display:"flex",flexDirection:"column",width:ce.d(this.environment),height:"100%",background:ce.i(this.environment)?this.theme.mobileSidebarAndroidBackground:this.theme.mobileSidebarIOSBackground,willChange:"transform",color:this.theme.mediumTextColor,...ce.i(this.environment)&&{marginLeft:"auto"},...ce.a(this.environment)&&{position:"absolute",right:0},cursor:"pointer"}}getTopbarStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"space-between",flex:"none",height:ve.b,marginTop:e.state.paddingTopCSS,paddingLeft:12,boxShadow:ce.i(this.environment)&&!ce.a(this.environment)&&se.c.state?this.isScrolledToTop.state?this.theme.topbarAndroidShadowCollapsed:this.theme.topbarAndroidShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:ce.i(this.environment)?this.theme.androidSidebarBackground:be.g.transparent,transition:"box-shadow 300ms",width:"100%",zIndex:1}}}a()(Ce,"outlinerStyle",{flexGrow:1,paddingTop:12,userSelect:"none",WebkitUserSelect:"none"}),a()(Ce,"actionButtonStyle",{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",height:"100%",width:44,paddingRight:6});t.default=Ce},W8UH:function(e,t,i){"use strict";i.r(t);var o=i("gcR/"),n=i.n(o),s=i("lSNA"),a=i.n(s),r=(i("3bBZ"),i("LvDl")),l=i.n(r),c=i("q1tI"),d=i("mKX5"),h=i("wldR"),u=i("mF3+"),m=i("LEzx");class p extends m.a{getInitialState(){return{}}}var b=p,g=i("Sb6f"),y=i("/YYm"),v=i("Oy36"),S=i("OxuQ"),f=i("IdIf"),k=i("0lqH"),M=i("D2XV"),T=i("7TLZ"),C=i("prF1"),w=i("SR/M"),A=i("vl8/");class x extends h.a{constructor(...e){super(...e),a()(this,"renderProperty",e=>{const{schema:t,store:i,blockPropertyValueOverlayStore:o}=this.props;if(t[e])return n()(k.b,{store:i,property:e,schema:t,disabled:!0,locked:!1,format:k.b.Format.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:o},e)})}renderComponent(){const{time:e,store:t}=this.props,i=t.hasIcon()||!t.isEmptyPage(),o=Object(y.a)({store:t,fullyQualified:!1}),s=T.i(t);return n()(C.a,{href:o},void 0,n()(w.a,{focused:!1,title:n()(c.Fragment,{},void 0,e&&n()("div",{style:{display:"flex",color:this.theme.mediumTextColor,fontSize:14,marginTop:8,marginBottom:6}},void 0,e),n()("div",{style:{display:"flex",alignItems:"center",...e&&{marginBottom:8}}},void 0,i&&n()(v.a,{disabled:!0,icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),size:24,style:{flexShrink:0,marginRight:8}}),n()(S.a,{store:t,style:{fontWeight:g.a.fontWeight.semibold}}),s>0&&n()("div",{style:{display:"flex",alignItems:"center",color:this.theme.regularDividerColor,fontSize:12,marginLeft:4,flexShrink:0}},void 0,u.a.speechBubble({width:12,height:12,marginRight:4,fill:this.theme.mediumIconColor}),s))),caption:this.renderProperties()}))}renderProperties(){const{format:e,schema:t,store:i}=this.props,o=(e.calendar_properties?e.calendar_properties.filter(e=>e.visible).map(e=>e.property):[]).filter(e=>f.e({blockValue:i.getValue(),property:e,schema:t,getRecordValue:i.getRecordValue,userTimeZone:M.m,intl:A.default.getIntl()}));if(o.length>0)return n()("div",{style:{marginTop:8}},void 0,o.map(this.renderProperty))}}var B=x,I=i("wpmu"),P=i("1QGs"),R=i("MBf9"),O=i("gbGO"),F=i("2Y+N"),D=i("nObc"),j=i("VVDu"),N=i("zTdN"),U=i("lCCU"),q=i("H4VD"),L=i("O+wX"),V=i("zgcg"),_=i("J9+s"),E=i("nPEg"),W=i("L/re"),z=i("RSEC"),G=i("hU3F"),Q=i("HRSx");class Z extends h.a{constructor(...e){super(...e),a()(this,"storeTypes",{store:b,resultStore:G.a.of(void 0)}),a()(this,"renderResults",()=>{const{disabled:e,collectionStore:t}=this.props,i=this.getCurrentStartOfDay(),o=i.clone().endOf("day"),s=this.getCurrentResults();return n()(O.b,{menuType:O.b.MenuType.Modal,title:n()("div",{style:Z.headerStyle},void 0,n()(U.a,{onClick:this.handleLeftClick,icon:u.a.chevronLeft,style:{marginRight:8,marginTop:2},mobileFeedback:!0}),n()("div",{},void 0,i.format("MMMM Do")),n()(U.a,{onClick:this.handleRightClick,icon:u.a.chevronRight,style:{marginLeft:8,marginTop:2},mobileFeedback:!0})),right:n()(E.DoneMenuText,{}),onClickRight:this.props.onDismiss},void 0,!s&&n()(F.a,{},void 0,n()(j.a,{})),s&&0===s.length&&n()(F.a,{},void 0,n()(N.a,{title:n()(_.FormattedMessage,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})),s&&s.length>0&&n()(F.a,{},void 0,s.map(e=>{const n=I.a.createChildStore(t,{id:e.id,table:Q.a});return this.renderItem(n,e,i,o)})),!e&&n()(F.a,{topBorder:!0},void 0,n()(D.a,{focused:!1,onClick:this.handleAddItemClick,title:n()(_.FormattedMessage,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})})))}),a()(this,"handleLeftClick",()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.clone().add(-1,"day").valueOf()})}),a()(this,"handleRightClick",()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.clone().add(1,"day").valueOf()})}),a()(this,"handleAddItemClick",()=>{const{collectionViewLocalStore:e,collectionStore:t,calendarBy:i,resultsStore:o}=this.props,n=this.getCurrentStartOfDay(),s=R.createAndCommit(this.environment,s=>P.e({environment:this.environment,collectionStore:t,collectionViewLocalStore:e,calendarBy:i,startOfDay:n.valueOf(),results:o.state,transaction:s})),a=Object(y.a)({store:s});this.navigate(a)}),a()(this,"reducerStore",this.createComputedStore(()=>{const{collectionViewLocalStore:e}=this.props;return Object(W.b)({collectionViewLocalStore:e,startOfDay:this.getCurrentStartOfDay().valueOf()})},!0)),a()(this,"getRecordValue",this.props.collectionStore.getRecordValue)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):q.navigate({environment:this.environment,url:e})}renderComponent(){const{collectionViewLocalStore:e}=this.props,t=this.reducerStore.state;if(t)return n()(z.a,{id:"calendar_day_results",reducer:t,collectionViewLocalStore:e,render:this.renderResults,resultStore:this.stores.resultStore})}renderItem(e,t,i,o){const{disabled:s,blockPropertyValueOverlayStore:a}=this.props;return n()(B,{store:e,time:t.includeTime?this.renderTime(t,i,o):void 0,disabled:s,format:this.props.format,schema:this.props.schema,blockPropertyValueOverlayStore:a},t.id)}renderTime(e,t,i){const{schema:o,calendarBy:n,intl:s}=this.props,a=o[n];if(!a||"date"!==a.type)return;const r=a.date_format||M.v,l=a.time_format||M.x,c=Object(d.a)(e.start),h=e.end?Object(d.a)(e.end):void 0,u=Boolean(!c.isBetween(t,i)||h&&!h.isBetween(t,i));if(e.end){const t=M.s(e.start.valueOf(),e.end?e.end.valueOf():e.start.valueOf(),e.timeZone);return u?Object(L.a)({value:t,date_format:r,time_format:l,userTimeZone:e.timeZone,allowRelativeDates:!0,intl:s}):Object(L.f)({start_time:t.start_time,end_time:t.end_time,time_format:l,humanReadable:!0,intl:s})}return Object(L.e)({start_time:M.r(e.start.valueOf(),e.timeZone).start_time,time_format:l,humanReadable:!0,intl:s})}getCurrentStartOfDay(){const{currentStartOfDay:e}=this.stores.store.state;return e?Object(d.a)(e):Object(d.a)(this.props.initialStartOfDay)}getCurrentResults(){const{collectionStore:e,collectionViewLocalStore:t}=this.props,i=this.stores.resultStore.state,o=t.normalizedQueryStore.state,n=t.normalizedSchemaStore.state,s=o?o.calendar_by:void 0;if(!(i&&o&&s&&n))return;let a=l.a.compact(i.blockIds.map(t=>{const i=I.a.createChildStore(e,{id:t,table:Q.a});return Object(W.a)({blockStore:i,calendarBy:s,schema:n,getRecordValue:this.getRecordValue,intl:this.props.intl})}));return o.sort||(a=l.a.sortBy(a,e=>e.start)),a}}a()(Z,"contextTypes",V.a),a()(Z,"headerStyle",{display:"flex",alignItems:"center",height:"100%"});t.default=Object(_.injectIntl)(Z)},ZKzj:function(e,t,i){"use strict";i.r(t);var o=i("pVnL"),n=i.n(o),s=i("gcR/"),a=i.n(s),r=i("lSNA"),l=i.n(r),c=(i("3bBZ"),i("q1tI")),d=i.n(c),h=i("LvDl"),u=i.n(h),m=i("mF3+"),p=i("l4I2"),b=i("CaJT"),g=i("6rsX"),y=i("y6Dp"),v=i("Sb6f"),S=i("wldR"),f=i("9hmv"),k=i("q8I6"),M=i("y4kc"),T=i("F9et"),C=i("unoy"),w=i("wXH4"),A=i("RI9y"),x=i("sjR4"),B=i("DNgp"),I=i("Iece"),P=i("MeYt"),R=i("typy"),O=i("J9+s"),F=i("xPzf"),D=i("VpIZ"),j=i("HTFi"),N=i("tCjx"),U=i("1G+a"),q=i("3Z0Q"),L=i("jVWm");class V extends S.a{constructor(...e){super(...e),l()(this,"scrollerDiv",void 0),l()(this,"currentlyShownTimer",void 0),l()(this,"previouslyShownOnNative",!1),l()(this,"handleScrollerRef",e=>{e&&(this.scrollerDiv=e)}),l()(this,"handleUnindent",e=>{q.r(this.environment)}),l()(this,"handleIndent",e=>{q.i(this.environment)}),l()(this,"handleMoveUp",e=>{q.n(this.environment)}),l()(this,"handleMoveDown",e=>{q.m(this.environment)}),l()(this,"handleUndo",()=>{q.q(this.environment)}),l()(this,"handleRedo",()=>{q.o(this.environment)}),l()(this,"handleDismissKeyboard",e=>{g.e(this.environment),this.props.stores.store.setState({...this.props.stores.store.state,isInsertOpen:!1}),this.trackItemTap("hide_keyboard"),C.e()}),l()(this,"handleInsert",e=>{this.props.stores.store.setState({...this.props.stores.store.state,isInsertOpen:!0}),this.trackItemTap("insert")}),l()(this,"handleTakePicture",e=>{q.h(this.environment)}),l()(this,"handleMention",e=>{q.k(this.environment)}),l()(this,"handleComment",e=>{q.e(this.environment,!1)}),l()(this,"handleDelete",e=>{q.f(this.environment)}),l()(this,"handleActionsScroll",()=>{y.e(this.environment)}),l()(this,"handleActionsScrollDebounced",u.a.debounce(this.handleActionsScroll,500)),l()(this,"handleMoreClick",e=>{q.l(this.environment,e.clientX,e.clientY)}),l()(this,"listenForPositionChanges",this.createComputedStore(()=>{const e=B.default.state,t="editing"===e.mode&&Object(L.a)("MobileActionBar",e.multiSelection);return t?{scrollTop:I.a.state.scrollTop,editing:!0,store:t.store.id,selection:t.selection.endIndex}:{scrollTop:I.a.state.scrollTop,editing:!1}})),l()(this,"shouldShow",this.createComputedStore(()=>{var e;return q.t(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)})),l()(this,"shouldShowTextActions",this.createComputedStore(()=>q.v(this.props.stores.ignoreSelectionAreaStore))),l()(this,"shouldShowBlockActions",this.createComputedStore(()=>!this.shouldShowTextActions.state)),l()(this,"canTriggerBlockActions",this.createComputedStore(()=>q.c(this.shouldShowBlockActions.state,this.pageContext&&this.pageContext.publicEditModeStore.state))),l()(this,"canTriggerTextActions",this.createComputedStore(()=>q.d(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore)))}willMountOrUpdate(){const{device:e}=this.environment,t=this.shouldShow.state;if(e.isMobileBrowser){const e=this.props.stores.store.state.isOpen;t?e?void 0!==this.currentlyShownTimer&&(window.clearTimeout(this.currentlyShownTimer),this.currentlyShownTimer=void 0):(this.props.stores.store.setState({...this.props.stores.store.state,isOpen:!0}),this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0)):e&&void 0===this.currentlyShownTimer&&(this.currentlyShownTimer=window.setTimeout(()=>{this.currentlyShownTimer=void 0,this.props.stores.store.setState({...this.props.stores.store.state,isOpen:!1})},200))}else t!==this.previouslyShownOnNative&&(this.previouslyShownOnNative=t,this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0))}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,i=this.isOpen(),o=e.isMobile&&j.a.state;if(this.props.position===U.a.Bottom)return a()("div",{style:{position:"absolute",bottom:o?t.getSafePaddingBottomCSS(N.default.height):0,left:0,height:V.height,width:"100%",pointerEvents:i?"auto":"none",opacity:i?1:0,transform:i?"translateY(0)":"translateY(".concat(V.height,"px)"),transition:"opacity 120ms ease-out, transform 120ms ease-out"}},void 0,this.renderActionButtons());{const e=this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionRect||A.getSelectionRect();if(!e)return;const t=document.body.getBoundingClientRect(),o={...e,left:10,top:e.top+10-t.top};this.listenForPositionChanges.state;const{device:n}=this.environment;return a()(w.c,{popupType:n.isMobileNative?w.c.PopupType.SlideUp:w.c.PopupType.Popup,open:i,preventBlockRenderQueueOnEnter:!0,placementToOrigin:w.c.Placement.Bottom,alignmentToOrigin:w.c.Alignment.Start,originRect:o,disableMouseCapture:!0,keepFocus:!0,render:()=>a()("div",{style:{height:V.height,width:"calc(80wv)",borderRadius:3,overflow:"hidden"}},void 0,this.renderActionButtons())})}}renderActionButtons(){const e=this.shouldShowTextActions.state,t=this.shouldShowBlockActions.state,i=q.u({environment:this.environment,store:this.props.currentBlockStore});return a()("div",{style:this.getActionButtonStyles()},void 0,i&&this.renderTemplatesButton(),!i&&t&&this.renderBlockActions(),!i&&e&&this.renderTextActions(),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderLeft:this.getItemBorder(),borderRight:"none"},onClick:this.handleDismissKeyboard},void 0,V.keyboardIcon))}renderBlockActions(){const e=this.canTriggerBlockActions.state;let t=!1,i=!1;const o=this.props.currentBlockStore.getValue();o&&(Object(D.C)(o)||(t=!0),Object(D.D)(o)||(i=!0));const{device:s}=this.environment;return d.a.createElement("div",{ref:this.handleScrollerRef,style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),...!s.isSmallPhone&&{paddingLeft:12,paddingRight:12}},onClick:this.handleInsert,disabled:!e},void 0,V.plusIcon,this.renderChevronDown()),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:v.a.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isTurnIntoOpen:!0}),this.trackItemTap("turn_into")},disabled:!e},void 0,a()(O.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.buttonTitle"}),this.renderChevronDown()),a()(T.a,{capture:!0,render:e=>d.a.createElement(P.a,n()({mobileFeedback:!0,disabledFeedback:!0},e,{style:this.getItemStyle(),onClick:this.handleMention,disabled:!i}),a()("span",{style:{fontSize:19,lineHeight:1,fontWeight:v.a.fontWeight.medium,marginBottom:s.isAndroid?4:0}},void 0,"@"))}),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleComment,disabled:!t},void 0,V.discussionIcon),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleTakePicture,disabled:!e},void 0,V.imageIcon),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleDelete,disabled:!e},void 0,V.trashIcon),this.renderBlockMovementActions(),this.renderBlockUndoActions(),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:v.a.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isColorOpen:!0}),this.trackItemTap("color")},disabled:!e},void 0,a()(O.FormattedMessage,{defaultMessage:"Color",id:"mobileActionBar.color.buttonTitle"}),this.renderChevronDown()),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:v.a.fontWeight.medium},onClick:this.handleMoreClick,disabled:!e},void 0,a()(O.FormattedMessage,{defaultMessage:"More",id:"mobileActionBar.more.buttonTitle"}),this.renderChevronDown()))}renderBlockMovementActions(){const e=this.canTriggerBlockActions.state,t=x.default.state.stores[0];return a()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:V.minorItemStyle,disabled:!e||!p.b(t),onClick:this.handleUnindent},void 0,V.unindentIcon),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:V.minorItemStyle,disabled:!e||!p.a(t),onClick:this.handleIndent},void 0,V.indentIcon),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:V.minorItemStyle,disabled:!e,onClick:this.handleMoveUp},void 0,V.moveUpIcon),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:V.minorItemStyle,disabled:!e,onClick:this.handleMoveDown},void 0,V.moveDownIcon))}renderBlockUndoActions(){return a()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:V.minorItemStyle,disabled:!b.b(),onClick:this.handleUndo},void 0,V.undoIcon),a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:V.minorItemStyle,disabled:!b.a(),onClick:this.handleRedo},void 0,V.redoIcon))}renderTextActions(){const e=this.canTriggerTextActions.state,t=this.props.currentBlockStore.canComment();return a()("div",{style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},void 0,a()(M.a,{style:this.getItemStyle(),blockStore:x.default.state.stores[0],disabled:!t}),a()(f.a,{type:"b",style:this.getItemStyle(),onClick:()=>this.trackItemTap("bold"),disabled:!e},void 0,a()("span",{style:{fontWeight:v.a.fontWeight.semibold}},void 0,a()(O.FormattedMessage,{defaultMessage:"B",id:"mobileActionBar.bold.symbol",description:"Letter 'B' which represents 'bold' format option."}))),a()(f.a,{type:"i",style:this.getItemStyle(),onClick:()=>this.trackItemTap("italic"),disabled:!e},void 0,a()("span",{style:{fontStyle:"italic",fontWeight:v.a.fontWeight.semibold}},void 0,a()(O.FormattedMessage,{defaultMessage:"i",id:"mobileActionBar.italic.symbol",description:"Letter 'i' which represents 'italic' format option."}))),a()(f.a,{type:"_",style:this.getItemStyle(),onClick:()=>this.trackItemTap("underline"),disabled:!e},void 0,a()("span",{style:{textDecoration:"underline"}},void 0,a()(O.FormattedMessage,{defaultMessage:"U",id:"mobileActionBar.underline.symbol",description:"Letter 'U' which represents 'underline' format option."}))),a()(f.a,{type:"s",style:this.getItemStyle(),onClick:()=>this.trackItemTap("strike_through"),disabled:!e},void 0,a()("span",{style:{textDecoration:"line-through"}},void 0,a()(O.FormattedMessage,{defaultMessage:"S",id:"mobileActionBar.strikeThrough.symbol",description:"Letter 'S' which represents 'strike-through' format option."}))),a()(f.a,{type:"c",style:this.getItemStyle(),onClick:()=>this.trackItemTap("code"),disabled:!e},void 0,a()("span",{style:{fontFamily:v.a.fontFamily.githubMono}},void 0,a()(O.FormattedMessage,{defaultMessage:"Code",id:"mobileActionBar.code.symbol",description:"Word 'code' which represents 'code' format option."}))),a()(k.a,{style:this.getItemStyle(),disabled:!e},void 0,a()("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},void 0,a()(O.FormattedMessage,{defaultMessage:"Link",id:"mobileActionBar.link.symbol",description:"Word 'link' which represents 'link' format option."}))),a()(F.a,{onClick:()=>this.trackItemTap("equation"),disabled:!e,style:this.getItemStyle()},void 0,m.a.equation({width:16,height:16})),a()(R.a,{style:this.getItemStyle(),ignoreSelectionAreaStore:this.props.stores.ignoreSelectionAreaStore,disabled:!e}))}renderTemplatesButton(){return a()("div",{style:this.getActionMenuStyle()},void 0,a()(P.a,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderRight:"none",fontWeight:v.a.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isTemplatesOpen:!0}),this.trackItemTap("templates")}},void 0,m.a.templatesColor({width:20,marginRight:8}),a()(O.FormattedMessage,{defaultMessage:"Choose a template...",id:"mobileActionBar.templates.buttonTitle"}),this.renderChevronDown()))}renderChevronDown(){return m.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.props.stores.store.state.isOpen:this.shouldShow.state}trackItemTap(e){y.Oe(this.environment,{itemName:e})}getItemBorder(){return"1px solid ".concat(this.theme.regularDividerColor)}getActionButtonStyles(){const{device:e,WindowSizeStore:t}=this.environment;return{height:"100%",width:"100%",fontSize:15,display:"flex",boxShadow:this.props.position===U.a.Bottom?this.theme.bottomActionBarShadow:this.theme.mediumBoxShadow,backgroundColor:this.theme.keyboardActionBarBackground,paddingLeft:e.isMobileNative?t.state.paddingLeftCSS:0,paddingRight:e.isMobileNative?t.state.paddingRightCSS:0}}getActionMenuStyle(){return{flexGrow:1,flexShrink:1,marginRight:-1,display:"flex",overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch"}}getItemStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:e.isSmallPhone?8:10,paddingRight:e.isSmallPhone?8:10,borderRight:this.getItemBorder(),whiteSpace:"nowrap",height:V.height,flexShrink:0,flexGrow:0,flexBasis:"auto",color:this.theme.regularTextColor,minWidth:e.isSmallPhone?42:44}}}l()(V,"unindentIcon",m.a.indentDown({width:18,height:18,transform:"rotate(90deg)",position:"relative",left:1})),l()(V,"indentIcon",m.a.indentDown({width:18,height:18,transform:"rotate(-90deg)",position:"relative",left:-1})),l()(V,"moveUpIcon",m.a.moveUp({width:18,height:18,position:"relative",left:2})),l()(V,"moveDownIcon",m.a.moveUp({width:18,height:18,transform:"rotate(180deg)",position:"relative",left:2})),l()(V,"undoIcon",m.a.undo({width:19,height:19})),l()(V,"redoIcon",m.a.redo({width:19,height:19})),l()(V,"trashIcon",m.a.trash({width:18,height:18})),l()(V,"discussionIcon",m.a.speechBubbleThin({width:18,height:18})),l()(V,"plusIcon",m.a.thinPlus({width:14,height:14})),l()(V,"keyboardIcon",m.a.keyboard({width:18,height:18})),l()(V,"imageIcon",m.a.image({width:18,height:18})),l()(V,"height",42),l()(V,"minorItemStyle",{width:34,justifyContent:"center"}),t.default=Object(O.injectIntl)(V)},fJfa:function(e,t,i){"use strict";i.r(t);var o=i("gcR/"),n=i.n(o),s=i("lSNA"),a=i.n(s),r=(i("3bBZ"),i("Zo/l")),l=i("q1tI"),c=i.n(l);function d(e,t){const i=Object(l.useRef)(Math.random().toString(36).substr(2,9)),o=t;return Object(l.useEffect)(()=>{const t=i.current;if(e)return e({type:"mount",id:t,props:o}),()=>e({type:"unmount",id:t})},[e,o]),e?i.current:void 0}var h=i("wldR"),u=i("J9+s"),m=(i("E9XD"),i("mINO")),p=i("pFdg");function b(e,t,i){const{content:o,apiRequestValue:n}=i;return{id:e,content:o,action:{type:t,apiRequestValue:n}}}const g=["insertBlock","turnInto","textColor","textSelectionColor"],y=["textFormatting"];function v(e,t){return{type:e,apiRequestValue:t}}function S(e,t){const i={type:e,data:t};return JSON.stringify(i)}const f={showActionBarMenu:m.j({required:{type:m.f("showActionBarMenu"),data:m.j({required:{actionBarMenuId:m.g("textColor","insertBlock","turnInto","template")},optional:{}})},optional:{}}),blockAction:m.j({required:{type:m.g("blockAction"),data:m.j({required:{action:m.g("bold","italic","underline","strikethrough","link","code","equation","mention","trash","comment","filePicker","indent","unindent","moveUp","moveDown","undo","redo","dismissKeyboard","more")},optional:{}})},optional:{}})},k=Object.keys(f);let M;!function(e){e[e.InvalidActionType=0]="InvalidActionType",e[e.MissingPayload=1]="MissingPayload",e[e.InvalidRequestType=2]="InvalidRequestType",e[e.InvalidData=3]="InvalidData"}(M||(M={}));class T{constructor(e,t){this.type=e,this.message=t}}function C(e){return 0===e.reduce((e,t)=>e+t.items.length,0)}function w(e){const{disableBlockActions:t,disableCommentAction:i,disableMentionAction:o,selectedMenuType:n,disableInsertBlockAction:s,disableTurnIntoAction:a,accessibilityTexts:r}=e;return{id:"mab.buttonSection.main",buttons:[b("mab.button.insert","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"plus",localImageIdentifier:"insertBlock"},accessibilityText:r.insert,disabled:t||s,selected:"insertBlock"===n},apiRequestValue:{menuType:"insertBlock"}}),b("mab.button.turnInto","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.2.squarepath",localImageIdentifier:"turnInto"},disabled:t||a,selected:"turnInto"===n,accessibilityText:r.turnInto},apiRequestValue:{menuType:"turnInto"}}),b("mab.button.filePicker","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"photo.on.rectangle.angled",localImageIdentifier:"filePicker"},disabled:t,accessibilityText:r.filePicker},apiRequestValue:{jsonPayload:S("blockAction",{action:"filePicker"})}}),b("mab.button.mention","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"at",localImageIdentifier:"mention"},disabled:o,accessibilityText:r.mention},apiRequestValue:{jsonPayload:S("blockAction",{action:"mention"})}}),b("mab.button.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:i,accessibilityText:r.comment},apiRequestValue:{jsonPayload:S("blockAction",{action:"comment"})}}),b("bold.italic.underline","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"bold.italic.underline",localImageIdentifier:"boldItalicUnderline"},accessibilityText:r.textFormatting},apiRequestValue:{subMenuType:"textFormatting"}}),b("mab.button.delete","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"delete.left",localImageIdentifier:"trash"},accessibilityText:r.trash},apiRequestValue:{jsonPayload:S("blockAction",{action:"trash"})}})]}}function A(e){return[b("mab.button.moveUp","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.up.to.line.alt",localImageIdentifier:"moveUp"},accessibilityText:e.accessibilityTexts.moveUp,disabled:e.disableBlockActions},apiRequestValue:{jsonPayload:S("blockAction",{action:"moveUp"})}}),b("mab.button.moveDown","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.down.to.line.alt",localImageIdentifier:"moveDown"},accessibilityText:e.accessibilityTexts.moveDown,disabled:e.disableBlockActions},apiRequestValue:{jsonPayload:S("blockAction",{action:"moveDown"})}})]}function x(e){const{id:t,disableBlockActions:i,disableIndent:o,disableUnindent:n,shouldFadeIn:s,includeUpAndDown:a,accessibilityTexts:r}=e;if(!(i||o&&n)){var l={id:t,shouldFadeIn:s,buttons:[b("mab.button.indent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"decrease.indent",localImageIdentifier:"unindent"},accessibilityText:r.dedent,disabled:i||n},apiRequestValue:{jsonPayload:S("blockAction",{action:"unindent"})}}),b("mab.button.unindent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"increase.indent",localImageIdentifier:"indent"},accessibilityText:r.indent,disabled:i||o},apiRequestValue:{jsonPayload:S("blockAction",{action:"indent"})}})]};if(a){var c=A({disableBlockActions:i,accessibilityTexts:{moveUp:r.moveUp,moveDown:r.moveDown}});l.buttons=l.buttons.concat(c)}return l}}function B(e){const{disableUndo:t,disableRedo:i,disableTextActions:o,disableTextColorAction:n,textColorImageReference:s,selectedMenuType:a,accessibilityTexts:r}=e;return{id:"mab.buttonSection.block",buttons:[b("mab.button.undo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.uturn.backward",localImageIdentifier:"undo"},accessibilityText:r.undo,disabled:t},apiRequestValue:{jsonPayload:S("blockAction",{action:"undo"})}}),b("mab.button.redo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.uturn.forward",localImageIdentifier:"redo"},accessibilityText:r.redo,disabled:i},apiRequestValue:{jsonPayload:S("blockAction",{action:"redo"})}}),b("mab.button.textColor.native","nativeAction_setMenuType",{content:{type:"icon",imageReference:s,disabled:o||n,selected:"textColor"===a,accessibilityText:r.blockColor},apiRequestValue:{menuType:"textColor"}}),b("mab.button.more","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"ellipsis",localImageIdentifier:"more"},accessibilityText:r.more},apiRequestValue:{jsonPayload:S("blockAction",{action:"more"})}})]}}var I=i("3Z0Q"),P=i("sjR4");function R(e){const{disableTextActions:t,boldSelected:i,italicSelected:o,underlineSelected:n,strikeSelected:s,codeSelected:a,linkSelected:r,equationSelected:l,selectedMenuType:c,disableTextColorAction:d,disableCommentAction:h,textColorImageReference:u,accessibilityTexts:m}=e;return{id:"mab.buttonSection.textFormatting",buttons:[b("mab.button.back","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.backward.2",localImageIdentifier:"back"},accessibilityText:m.close},apiRequestValue:{subMenuType:null}}),b("mab.button.bold","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bold",localImageIdentifier:"bold"},accessibilityText:m.bold,disabled:t,selected:i},apiRequestValue:{jsonPayload:S("blockAction",{action:"bold"})}}),b("mab.button.italic","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"italic",localImageIdentifier:"italic"},disabled:t,selected:o,accessibilityText:m.italics},apiRequestValue:{jsonPayload:S("blockAction",{action:"italic"})}}),b("mab.button.underline","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"underline",localImageIdentifier:"underline"},disabled:t,selected:n,accessibilityText:m.underline},apiRequestValue:{jsonPayload:S("blockAction",{action:"underline"})}}),b("mab.button.strikethrough","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"strikethrough",localImageIdentifier:"strikethrough"},disabled:t,selected:s,accessibilityText:m.strikethrough},apiRequestValue:{jsonPayload:S("blockAction",{action:"strikethrough"})}}),b("mab.button.textFormatting.textSelectionColor.native","nativeAction_setMenuType",{content:{type:"icon",imageReference:u,disabled:t||d,selected:"textSelectionColor"===c,accessibilityText:m.textColor},apiRequestValue:{menuType:"textSelectionColor"}}),b("mab.button.textFormatting.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:t||h,accessibilityText:m.comment},apiRequestValue:{jsonPayload:S("blockAction",{action:"comment"})}}),b("mab.button.link","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"link",localImageIdentifier:"link"},accessibilityText:m.link,disabled:t,selected:r},apiRequestValue:{jsonPayload:S("blockAction",{action:"link"})}}),b("mab.button.code","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.left.slash.chevron.right",localImageIdentifier:"code"},accessibilityText:m.code,disabled:t,selected:a},apiRequestValue:{jsonPayload:S("blockAction",{action:"code"})}}),b("mab.button.equation","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"x.squareroot",localImageIdentifier:"equation"},accessibilityText:m.equation,disabled:t,selected:l},apiRequestValue:{jsonPayload:S("blockAction",{action:"equation"})}}),b("mab.button.cancel","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"xmark.circle.fill",localImageIdentifier:"cancel"},accessibilityText:m.close},apiRequestValue:{subMenuType:null}})]}}var O=i("VpIZ"),F=i("l4I2"),D=i("CaJT"),j=i("wiBh"),N=i("cBa6"),U=i("6rsX"),q=i("unoy"),L=i("zmp8"),V=i("BJyN"),_=i("vl8/"),E=i("A9TN"),W=i("qxI2");function z(e){const{type:t,actionSections:i,closeParentMenu:o,context:n}=e,s=new Map,a=[];return i.forEach(e=>{const i={id:"".concat(e.key),title:e.title,items:e.actions.map(e=>{const i="".concat(e.key,"-").concat(e.displayName||"");s[i]={...e,closeParentMenu:o};const a=e.nativeRender&&e.nativeRender(n),r=null==a?void 0:a.thumbnail;return{id:i,title:e.displayName||"",icon:{...a,remoteImageUrl:r?"".concat(E.default.domainBaseUrl).concat(r):void 0,localAssetBundleImagePath:r},action:v("webAction_genericAction",{menuType:t,actionId:i}),checked:!1}})};a.push(i)}),{actions:s,sections:a}}function G(e){const{key:t,displayName:i,thumbnail:o,analyticsName:n,closeParentMenu:s,action:a}=e,r=i?_.default.formatMessage(i):void 0,l=i,c=l?"".concat(_.default.formatMessage(l)," ").concat(l.defaultMessage):void 0;return{key:"action ".concat(t),displayName:r,thumbnail:o,analyticsName:n||"textformatting_action_".concat(t),searchName:c,validators:[],action:a,closeParentMenu:Boolean(s)}}const Q={bold:G({key:"bold",closeParentMenu:!1,action:({environment:e})=>{I.p(e,["b"])}}),italic:G({key:"italic",closeParentMenu:!1,action:({environment:e})=>{I.p(e,["i"])}}),underline:G({key:"underline",closeParentMenu:!1,action:({environment:e})=>{I.p(e,["_"])}}),strikethrough:G({key:"strikethrough",closeParentMenu:!1,action:({environment:e})=>{I.p(e,["s"])}}),code:G({key:"code",closeParentMenu:!1,action:({environment:e})=>{I.p(e,["c"])}}),comment:G({key:"comment",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),I.e(e,!0)}}),equation:G({key:"equation",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),I.g(e)}}),filePicker:G({key:"filePicker",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),I.h(e)}}),indent:G({key:"indent",closeParentMenu:!1,action:({environment:e})=>{I.i(e)}}),unindent:G({key:"unindent",closeParentMenu:!1,action:({environment:e})=>{I.r(e)}}),moveDown:G({key:"moveDown",closeParentMenu:!1,action:({environment:e})=>{I.m(e)}}),moveUp:G({key:"moveUp",closeParentMenu:!1,action:({environment:e})=>{I.n(e)}}),undo:G({key:"undo",closeParentMenu:!1,action:({environment:e})=>{I.q(e)}}),redo:G({key:"redo",closeParentMenu:!1,action:({environment:e})=>{I.o(e)}}),trash:G({key:"trash",closeParentMenu:!1,action:({environment:e})=>{I.f(e)}}),mention:G({key:"mention",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),I.k(e)}}),link:G({key:"link",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),I.j(e)}}),more:G({key:"more",closeParentMenu:!1,action:({environment:e})=>{I.l(e,void 0,void 0)}}),dismissKeyboard:G({key:"dismissKeyboard",closeParentMenu:!0,action:({environment:e})=>{}})};var Z=i("QcDD"),H=i("LvDl"),J=i.n(H),K=i("DNgp"),X=i("wllP"),Y=i("jVWm");const $=Object(u.defineMessages)({templatesButtonTitle:{defaultMessage:"Choose a template...",id:"mobileActionBar.templateButtonTitle"},actionMenuInsertBlockTitle:{defaultMessage:"Insert Block",id:"mobileActionBar.actionMenuTitle.insertBlock"},actionMenuTurnIntoTitle:{defaultMessage:"Turn Into",id:"mobileActionBar.actionMenuTitle.turnInto"},actionMenuColorTitle:{defaultMessage:"Color",id:"mobileActionBar.actionMenuTitle.blockColor"},accessibilityInsert:{defaultMessage:"Add block",id:"mobileActionBar.accessibility.insertBlock",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTurnInto:{defaultMessage:"Turn into block",id:"mobileActionBar.accessibility.turnInto",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityFilePicker:{defaultMessage:"Add image",id:"mobileActionBar.accessibility.filePicker",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMention:{defaultMessage:"Add mention",id:"mobileActionBar.accessibility.mention",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityBlockColor:{defaultMessage:"Change block color",id:"mobileActionBar.accessibility.blockColor",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTextFormatting:{defaultMessage:"Open text formatting menu",id:"mobileActionBar.accessibility.textFormatting",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityComment:{defaultMessage:"Add comment",id:"mobileActionBar.accessibility.comment",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTrash:{defaultMessage:"Delete block",id:"mobileActionBar.accessibility.trash",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityIndent:{defaultMessage:"Indent block",id:"mobileActionBar.accessibility.indent",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityDedent:{defaultMessage:"Unindent block",id:"mobileActionBar.accessibility.unindent",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMoveUp:{defaultMessage:"Move a block up",id:"mobileActionBar.accessibility.moveUp",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMoveDown:{defaultMessage:"Move a block down",id:"mobileActionBar.accessibility.moveDown",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityUndo:{defaultMessage:"Undo edit",id:"mobileActionBar.accessibility.udno",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityRedo:{defaultMessage:"Redo edit",id:"mobileActionBar.accessibility.redo",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMore:{defaultMessage:"More block actions",id:"mobileActionBar.accessibility.more",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityBold:{defaultMessage:"Bold",id:"mobileActionBar.accessibility.bold",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityItalics:{defaultMessage:"Italicize",id:"mobileActionBar.accessibility.italics",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityUnderline:{defaultMessage:"Underline",id:"mobileActionBar.accessibility.underline",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityStrikethrough:{defaultMessage:"Strikethrough",id:"mobileActionBar.accessibility.strikethrough",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTextColor:{defaultMessage:"Text color",id:"mobileActionBar.accessibility.textColor",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCode:{defaultMessage:"Code",id:"mobileActionBar.accessibility.code",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityLink:{defaultMessage:"Add link",id:"mobileActionBar.accessibility.link",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityEquation:{defaultMessage:"Add equation",id:"mobileActionBar.accessibility.equation",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCloseTextFormattingMenu:{defaultMessage:"Close text formatting menu",id:"mobileActionBar.accessibility.close",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityDismissKeyboard:{defaultMessage:"End editing",id:"mobileActionBar.accessibility.endEditing",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCloseActionMenu:{defaultMessage:"Close menu",id:"mobileActionBar.accessibility.closeMenu",description:"Accessibility text, this will be read aloud by the screen reader"}}),ee={text:!1,to_do:!0,bulleted_list:!0,numbered_list:!0,toggle:!0,column:!1,transclusion_container:!1};function te(e){var t;const{onAction:i,fallbackRenderer:o,...n}=e,s=d(null===(t=Object(r.b)().mobileNative)||void 0===t?void 0:t.api.renderMobileActionBar,n);return function(e,t,i,o){var n;const s=null===(n=Object(r.b)().mobileNative)||void 0===n?void 0:n.componentEvents;Object(l.useEffect)(()=>{if(s&&o&&t)return s.addListener(e,t,i,o)},[e,t,i,o,s])}("MobileActionBar",s,"onAction",i),!s&&o?c.a.createElement(c.a.Fragment,null,o()):null}class ie extends h.a{constructor(...e){super(...e),a()(this,"handleTextSelectionCompositeStoreChanged",()=>{if(!this.textSelectionCompositeStore.state)return;const{source:e}=this.textSelectionCompositeStore.state,{NativeMobileActionBarStore:t,device:i}=this.environment;"TextSelectionStore"!==e||null===(null==t?void 0:t.state.menuType)||i.isTablet||this.setCurrentMenuType(null,!0)}),a()(this,"handleTextSelectionStoreChanged",()=>{if(!this.textSelectionStore.state)return;const{NativeMobileActionBarStore:e}=this.environment;e&&null===e.state.subMenuType&&e.state.isSubMenuOverridden&&this.setCurrentSubMenuType(null,!1)}),a()(this,"getCurrentActionBarSchema",this.createComputedStore(()=>{const{NativeMobileActionBarStore:e}=this.environment,t=e?e.state.menuType:null;var i=null;const o=I.u({environment:this.environment,store:this.props.currentBlockStore}),n=!!e&&e.state.isSubMenuOverridden,s=this.shouldShowTextActions.state,a=e?e.state.subMenuType:null;n?i=a:s&&(i="textFormatting",null==e||e.update(e=>({...e,isSubMenuOverridden:!1,subMenuType:null})));const r=!this.canTriggerTextActions.state,l=!this.canTriggerBlockActions.state,c=this.props.currentBlockStore.getValue(),d=this.commentActionDisabled(c),h=this.mentionActionDisabled(c),u=P.default.state.stores[0],m=!F.a(u),p=!F.b(u),g=!D.b(),y=!D.a(),v=this.memoizedNativeMenus({environment:this.environment,blocks:P.default.state.stores}),f=C(v.textColor.sections);var k,M,T;if(o)k=[(T=_.default.formatMessage($.templatesButtonTitle),{id:"mab.buttonSection.template",buttons:[b("mab.button.choose_template","webAction_generic",{content:{type:"text_and_icon",imageReference:{localImageIdentifier:"template"},text:T},apiRequestValue:{jsonPayload:S("showActionBarMenu",{actionBarMenuId:"template"})}})]})];else{var O,j;const e={main:w({disableBlockActions:l,disableCommentAction:d,disableMentionAction:h,selectedMenuType:t,disableInsertBlockAction:C(v.insertBlock.sections),disableTurnIntoAction:C(v.turnInto.sections),accessibilityTexts:{insert:_.default.formatMessage($.accessibilityInsert),turnInto:_.default.formatMessage($.accessibilityTurnInto),filePicker:_.default.formatMessage($.accessibilityFilePicker),mention:_.default.formatMessage($.accessibilityMention),comment:_.default.formatMessage($.accessibilityComment),textFormatting:_.default.formatMessage($.accessibilityTextFormatting),trash:_.default.formatMessage($.accessibilityTrash)}}),listPrioritized:x({id:"mab.list.prioritized",disableBlockActions:l,disableIndent:m,disableUnindent:p,shouldFadeIn:!1,includeUpAndDown:!1,accessibilityTexts:{indent:_.default.formatMessage($.accessibilityIndent),dedent:_.default.formatMessage($.accessibilityDedent),moveUp:_.default.formatMessage($.accessibilityMoveUp),moveDown:_.default.formatMessage($.accessibilityMoveDown)}}),listDeprioritized:x({id:"mab.list.deprioritized",disableBlockActions:l,disableIndent:m,disableUnindent:p,shouldFadeIn:!0,includeUpAndDown:!0,accessibilityTexts:{indent:_.default.formatMessage($.accessibilityIndent),dedent:_.default.formatMessage($.accessibilityDedent),moveUp:_.default.formatMessage($.accessibilityMoveUp),moveDown:_.default.formatMessage($.accessibilityMoveDown)}}),block:B({disableUndo:g,disableRedo:y,textColorImageReference:this.textColorImageReference(),disableTextActions:r,disableTextColorAction:f,selectedMenuType:t,accessibilityTexts:{undo:_.default.formatMessage($.accessibilityUndo),redo:_.default.formatMessage($.accessibilityRedo),blockColor:_.default.formatMessage($.accessibilityBlockColor),more:_.default.formatMessage($.accessibilityMore)}}),moveUpAndDown:(M={disableBlockActions:l,accessibilityTexts:{moveUp:_.default.formatMessage($.accessibilityMoveUp),moveDown:_.default.formatMessage($.accessibilityMoveDown)}},{id:"mab.buttonSection.last",shouldFadeIn:!0,buttons:A(M)})},i="editing"===K.default.state.mode&&(null===(O=Object(Y.a)("NativeMobileActionBar",K.default.state.multiSelection))||void 0===O?void 0:O.store),o=this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,n=o&&"editing"===o.mode&&(null===(j=Object(Y.a)("NativeMobileActionBar",o.multiSelection))||void 0===j?void 0:j.store),s=i||n,a=s&&Object(X.c)(s);k=e.listPrioritized&&a&&a.state.value&&ee[a.state.value.type]?[e.listPrioritized,e.main,e.block,e.moveUpAndDown]:e.listDeprioritized&&a&&(F.a(a)||F.b(a))?[e.main,e.block,e.listDeprioritized]:[e.main,e.block,e.moveUpAndDown]}const N=[R({disableTextActions:r,disableCommentAction:d,selectedMenuType:t,disableTextColorAction:f,textColorImageReference:this.textSelectionColorImageReference(),accessibilityTexts:{bold:_.default.formatMessage($.accessibilityBold),italics:_.default.formatMessage($.accessibilityItalics),underline:_.default.formatMessage($.accessibilityUnderline),strikethrough:_.default.formatMessage($.accessibilityStrikethrough),textColor:_.default.formatMessage($.accessibilityTextColor),comment:_.default.formatMessage($.accessibilityComment),code:_.default.formatMessage($.accessibilityCode),link:_.default.formatMessage($.accessibilityLink),equation:_.default.formatMessage($.accessibilityEquation),close:_.default.formatMessage($.accessibilityCloseTextFormattingMenu)},...this.getTextFormattingSelections()})];return function(e){const{selectedMenu:t,selectedSubMenu:i,nativeMenus:o,buttonSections:n,nativeSubMenus:s,accessibilityTexts:a}=e;return{actionApi:{nativeAction_setSubMenuType:{request:{subMenuType:null},response:{}},nativeAction_hideKeyboard:{request:{},response:{}},nativeAction_setMenuType:{request:{menuType:null},response:{}},webAction_generic:{request:{jsonPayload:"{}"},response:{}},webAction_genericAction:{request:{menuType:null,actionId:""},response:{}}},nativeMenus:o,nativeSubMenus:s,state:{buttonSections:n,selectedMenu:t,selectedSubMenu:i,dismissKeyboardButton:null!==t?b("mab.dismissKeyboard","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"xmark.circle.fill",localImageIdentifier:"cancel"},accessibilityText:a.closeActionMenu},apiRequestValue:{menuType:null}}):b("mab.dismissKeyboard","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"keyboard.chevron.compact.down",localImageIdentifier:"keyboardDown"},accessibilityText:a.dismissKeyboard},apiRequestValue:{jsonPayload:S("blockAction",{action:"dismissKeyboard"})}}),mutatedNativeMenus:{},localizedMessages:{}}}}({selectedMenu:t,selectedSubMenu:i,nativeMenus:{textColor:{id:"textColor",title:_.default.formatMessage($.actionMenuColorTitle),sections:v.textColor.sections},textSelectionColor:{id:"textSelectionColor",title:_.default.formatMessage($.actionMenuColorTitle),sections:v.textSelectionColor.sections},insertBlock:{id:"insertBlock",title:_.default.formatMessage($.actionMenuInsertBlockTitle),sections:v.insertBlock.sections},turnInto:{id:"turnInto",title:_.default.formatMessage($.actionMenuTurnIntoTitle),sections:v.turnInto.sections}},nativeSubMenus:{textFormatting:N},buttonSections:k,accessibilityTexts:{dismissKeyboard:_.default.formatMessage($.accessibilityDismissKeyboard),closeActionMenu:_.default.formatMessage($.accessibilityCloseActionMenu)}})})),a()(this,"textSelectionStore",this.createComputedStore(()=>{if(this.textSelectionCompositeStore.state)return this.textSelectionCompositeStore.state.selection})),a()(this,"textSelectionCompositeStore",this.createComputedStore(()=>{if("editing"!==K.default.state.mode){const e=this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState;if(!e||"editing"!==e.mode)return;const t=Object(Y.a)("NativeMobileActionBar",e.multiSelection);if(!t)return;return{record:t.store.pointer,selection:t.selection,source:"IgnoreSelectionAreaStore"}}const e=Object(Y.a)("NativeMobileActionBar",K.default.state.multiSelection);if(!e)return;const{store:t,selection:i}=e;return{record:t&&t.pointer,selection:i,source:"TextSelectionStore"}},!0)),a()(this,"shouldShow",this.createComputedStore(()=>{var e;return I.t(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)})),a()(this,"canShow",this.createComputedStore(()=>{var e;const t=I.a(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state),i=I.b({environment:this.environment});return t&&i})),a()(this,"shouldShowTextActions",this.createComputedStore(()=>I.v(this.props.stores.ignoreSelectionAreaStore))),a()(this,"shouldShowBlockActions",this.createComputedStore(()=>!this.shouldShowTextActions.state)),a()(this,"canTriggerBlockActions",this.createComputedStore(()=>I.c(this.shouldShowBlockActions.state,this.pageContext&&this.pageContext.publicEditModeStore.state))),a()(this,"canTriggerTextActions",this.createComputedStore(()=>I.d(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore))),a()(this,"memoizedNativeMenus",J.a.memoize(e=>{const{blocks:t,environment:i}=e;return o={environment:i,blocks:t},{insertBlock:z({type:"insertBlock",actionSections:W.a(V.i,o),context:o,closeParentMenu:!0}),turnInto:z({type:"turnInto",actionSections:W.a([V.t],o),context:o,closeParentMenu:!0}),textColor:z({type:"textColor",actionSections:W.a([V.p,V.b],o),context:o,closeParentMenu:!1}),textSelectionColor:z({type:"textSelectionColor",actionSections:W.a([V.q,V.c],o),context:o,closeParentMenu:!1})};var o}))}didMount(){this.textSelectionCompositeStore.addListener(this.handleTextSelectionCompositeStoreChanged),this.textSelectionStore.addListener(this.handleTextSelectionStoreChanged)}willUnmount(){this.textSelectionCompositeStore.removeListener(this.handleTextSelectionCompositeStoreChanged),this.textSelectionStore.removeListener(this.handleTextSelectionStoreChanged)}renderComponent(){return n()(te,{isOpen:Boolean(this.shouldShow.state),canShow:Boolean(this.canShow.state),schema:this.getCurrentActionBarSchema.state,onAction:e=>{const{action:t}=e;switch(t.type){case"nativeAction_hideKeyboard":break;case"nativeAction_setMenuType":this.handleSetMenuTypeAction(t);break;case"nativeAction_setSubMenuType":this.handleSetSubMenuTypeAction(t);break;case"webAction_generic":this.handleGenericWebAction(t);break;case"webAction_genericAction":this.handleActionRegistryAction(t)}},fallbackRenderer:this.props.fallbackRenderer})}commentActionDisabled(e){return!(!e||!Object(O.C)(e))}mentionActionDisabled(e){return!(!e||!Object(O.D)(e))}handleSetMenuTypeAction(e){const t=function(e){if("nativeAction_setMenuType"!==e.type)return new T(M.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("menuType"in t))return new T(M.MissingPayload,void 0);const i=m.j({required:{menuType:m.g(...g,null)},optional:{}}),o=Object(p.d)(i,t);return o?new T(M.InvalidRequestType,JSON.stringify(o)):t.menuType}(e);if(t instanceof T)return void console.error(JSON.stringify(t));(this.environment.NativeMobileActionBarStore?this.environment.NativeMobileActionBarStore.state.menuType:null)===t?this.setCurrentMenuType(null,!0):this.setCurrentMenuType(t,!0)}handleSetSubMenuTypeAction(e){const t=function(e){if("nativeAction_setSubMenuType"!==e.type)return new T(M.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("subMenuType"in t))return new T(M.MissingPayload,void 0);const i=m.j({required:{subMenuType:m.g(...y,null)},optional:{}}),o=Object(p.d)(i,t);return o?new T(M.InvalidRequestType,JSON.stringify(o)):t.subMenuType}(e);t instanceof T?console.error(JSON.stringify(t)):this.setCurrentSubMenuType(t,!0)}handleGenericWebAction(e){const t=function(e){if("webAction_generic"!==e.type)return new T(M.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("jsonPayload"in t))return new T(M.MissingPayload,void 0);const i=JSON.parse(t.jsonPayload),o=m.j({required:{type:m.g(...k)},optional:{}}),n=Object(p.d)(o,i);if(n)return new T(M.InvalidRequestType,JSON.stringify(n));const s=i,a=f[s.type],r=Object(p.d)(a,s);return r?new T(M.InvalidData,JSON.stringify(r)):s}(e);if(t instanceof T)console.error(JSON.stringify(t));else switch(t.type){case"blockAction":if("dismissKeyboard"===t.data.action){this.handleDismissKeyboard();break}const e=Q[t.data.action];if(!e)break;const i=e.action;if(i){const{currentBlockStore:t}=Z.default.state;if(!t)break;const{device:o}=this.environment;e.closeParentMenu&&!o.isTablet&&this.setCurrentMenuType(null,!0),i({environment:this.environment,blocks:[t]})}break;case"showActionBarMenu":switch(t.data.actionBarMenuId){case"insertBlock":this.handleInsert();break;case"textColor":this.handleTextColor();break;case"turnInto":this.handleTurnInto();break;case"template":this.handleTemplate()}}}handleActionRegistryAction(e){var t,i;const o=null===(t=e.apiRequestValue)||void 0===t?void 0:t.menuType,n=null===(i=e.apiRequestValue)||void 0===i?void 0:i.actionId;if(!o||!n)return;const s=this.memoizedNativeMenus({environment:this.environment,blocks:P.default.state.stores})[o].actions[n];if(!s)return;const a=s.action;a&&(s.closeParentMenu&&this.setCurrentMenuType(null,!0),a({environment:this.environment,blocks:P.default.state.stores}))}handleDismissKeyboard(){U.e(this.environment),this.props.stores.store.update(e=>({...e,isInsertOpen:!1})),this.setCurrentMenuType(null,!1),I.w(this.environment,"hide_keyboard"),q.e()}getTextFormattingSelections(){return{boldSelected:Boolean(Object(j.b)(N.b.Bold)),italicSelected:Boolean(Object(j.b)(N.b.Italic)),underlineSelected:Boolean(Object(j.b)(N.b.Underline)),strikeSelected:Boolean(Object(j.b)(N.b.Strike)),codeSelected:Boolean(Object(j.b)(N.b.Code)),linkSelected:Boolean(Object(j.b)(N.b.Link)),equationSelected:Boolean(Object(j.b)(N.b.Equation))}}imageReferenceForBlockColor(e){let t="textColor";const i=Object.keys(this.theme.blockColors).find(t=>t===e);let o=void 0;"default"===e||i&&(i.includes("background")?(o="background",t="textBackgroundColor"):o="color");const n=o&&i?this.theme.blockColors[i][o]:void 0;return{localImageIdentifier:t,imageTintColor:n?Object(L.m)(n):void 0}}textSelectionColorImageReference(){const{NativeMobileActionBarStore:e}=this.environment,t=e&&null!==e.state.menuType?this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState:void 0,i=Object(j.c)("h",t||K.default.state),o=i?Object(N.Q)(i):void 0;return this.imageReferenceForBlockColor(o)}textColorImageReference(){const e=P.default.state.stores.length>0?P.default.state.stores[0].getFormat().block_color:void 0;return this.imageReferenceForBlockColor(e)}handleInsert(){this.props.stores.store.update(e=>({...e,isInsertOpen:!0})),I.w(this.environment,"insert")}handleTurnInto(){this.props.stores.store.update(e=>({...e,isTurnIntoOpen:!0})),I.w(this.environment,"turn_into")}handleTemplate(){this.props.stores.store.update(e=>({...e,isTemplatesOpen:!0})),I.w(this.environment,"templates")}handleTextColor(){this.props.stores.store.update(e=>({...e,isColorOpen:!0})),I.w(this.environment,"color")}setCurrentMenuType(e,t){var i;null===(i=this.environment.NativeMobileActionBarStore)||void 0===i||i.update(i=>({...i,menuType:e,shouldRestoreSelectionForMenu:t}))}setCurrentSubMenuType(e,t){const{NativeMobileActionBarStore:i}=this.environment;null==i||i.update(i=>({...i,isSubMenuOverridden:t,subMenuType:e}))}}t.default=Object(u.injectIntl)(ie)},sgAB:function(e,t,i){"use strict";i.r(t);var o=i("gcR/"),n=i.n(o),s=i("pVnL"),a=i.n(s),r=i("lSNA"),l=i.n(r),c=(i("3bBZ"),i("q1tI")),d=i.n(c),h=i("y6Dp"),u=i("BJyN"),m=i("LEzx");class p extends m.a{getInitialState(){return{isOpen:!1,isInsertOpen:!1,isTurnIntoOpen:!1,isColorOpen:!1,isTemplatesOpen:!1}}}var b=p,g=i("VOS9"),y=i("gbGO"),v=i("wldR"),S=i("2HDO"),f=i("F9et"),k=i("ikHm"),M=i("wXH4"),T=i("sjR4"),C=i("DNgp"),w=i("6nbh"),A=i("J9+s"),x=i("RQ1t"),B=i("WgIs"),I=i("rro+"),P=i("ui+/"),R=i("bVDK"),O=i("30UQ"),F=i("nM47"),D=i("2Y+N"),j=i("nPEg"),N=i("3Z0Q");class U extends v.a{constructor(...e){super(...e),l()(this,"storeTypes",{store:b,ignoreSelectionAreaStore:w.a,templatePickerMenuListStore:x.a}),l()(this,"renderMobileTemplatePreviewItem",e=>({key:e.name,render:t=>d.a.createElement(R.a,a()({},t,{key:e.name,title:e.name,type:"page_template",format:"phone-modal",emoji:e.emoji,locked:!1})),action:()=>{O.i({environment:this.environment,item:e,createNewPage:!1,isPrivate:!1})}})),l()(this,"renderPageTemplatePickerItem",e=>{const t=this.props.currentBlockStore;return{key:e.name,render:t=>d.a.createElement(R.a,a()({},t,{key:e.name,format:"phone-modal",title:e.name,type:e.type,icon:e.icon,locked:!1})),action:i=>{t&&Object(F.j)(this.environment)&&(h.ve(this.environment,{name:e.name,is_keyboard:"keydown"===i.event.type}),e.onClick(this.environment,t))}}}),l()(this,"handleCloseColorPopup",()=>{this.stores.store.setState({...this.stores.store.state,isColorOpen:!1})}),l()(this,"handleCloseInsertPopup",()=>{this.stores.store.setState({...this.stores.store.state,isInsertOpen:!1})}),l()(this,"handleCloseTurnIntoPopup",()=>{this.stores.store.setState({...this.stores.store.state,isTurnIntoOpen:!1})}),l()(this,"handleCloseTemplatesPopup",()=>{this.stores.store.setState({...this.stores.store.state,isTemplatesOpen:!1})}),l()(this,"shouldShow",this.createComputedStore(()=>{var e;return N.t(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)}))}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,i=this.isOpen(),{makeActionBarComponent:o}=this.props;return n()(c.Fragment,{},void 0,n()(f.a,{capture:!0,render:e=>d.a.createElement("div",a()({},e,{style:{position:"relative",width:"100%",height:0,zIndex:k.j}}),o(this.stores),this.renderNativeMenuIgnoreSelectionArea(),this.renderInsertPopup(),this.renderTurnIntoPopup(),this.renderColorPopup(),this.renderTemplatesPopup())}),!i&&e.isIPhoneX&&e.isNative&&n()("div",{style:{position:"absolute",bottom:0,background:"transparent",height:t.state.paddingBottomCSS,width:"100%",pointerEvents:"none",WebkitUserSelect:"none"}}))}renderNativeMenuIgnoreSelectionArea(){const e=this.environment.NativeMobileActionBarStore;return e?n()(S.a,{store:this.stores.ignoreSelectionAreaStore,capture:N.s(this.environment),ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:"editing"!==C.default.state.mode&&e.state.shouldRestoreSelectionForMenu,render:e=>null}):null}renderInsertPopup(){const{device:e}=this.environment;return n()(S.a,{capture:this.stores.store.state.isInsertOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:t=>n()(M.c,{popupType:e.isMobile?M.c.PopupType.SlideUp:M.c.PopupType.Popup,preventBlockRenderQueueOnEnter:!0,open:this.stores.store.state.isInsertOpen,keepFocus:!0,onDismiss:()=>{t(),this.handleCloseInsertPopup()},render:()=>n()(y.b,{menuType:y.b.MenuType.Modal,title:n()(A.FormattedMessage,{defaultMessage:"Insert block",id:"mobileActionBar.insertBlock.modalTitle"}),right:n()(j.CancelMenuText,{}),onClickRight:()=>{t(),this.handleCloseInsertPopup()}},void 0,n()(g.a,{sections:u.i,context:{environment:this.environment,blocks:T.default.state.stores},onAccept:this.handleCloseInsertPopup}))})})}renderTurnIntoPopup(){const{device:e}=this.environment;return n()(S.a,{capture:this.stores.store.state.isTurnIntoOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>n()(M.c,{popupType:e.isMobile?M.c.PopupType.SlideUp:M.c.PopupType.Popup,open:this.stores.store.state.isTurnIntoOpen,keepFocus:!0,onDismiss:this.handleCloseTurnIntoPopup,preventBlockRenderQueueOnEnter:!0,render:()=>n()(y.b,{menuType:y.b.MenuType.Modal,title:n()(A.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.modalTitle"}),right:n()(j.CancelMenuText,{}),onClickRight:this.handleCloseTurnIntoPopup},void 0,n()(g.a,{sections:[{...u.t,title:""}],context:{environment:this.environment,blocks:T.default.state.stores},onAccept:this.handleCloseTurnIntoPopup}))})})}renderColorPopup(){const{device:e}=this.environment;return n()(S.a,{capture:this.stores.store.state.isColorOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>n()(M.c,{popupType:e.isMobile?M.c.PopupType.SlideUp:M.c.PopupType.Popup,open:this.stores.store.state.isColorOpen,keepFocus:!0,onDismiss:this.handleCloseColorPopup,preventBlockRenderQueueOnEnter:!0,render:()=>n()(y.b,{menuType:y.b.MenuType.Modal,title:n()(A.FormattedMessage,{defaultMessage:"Block color",id:"mobileActionBar.blockColor.modalTitle"}),right:n()(j.CancelMenuText,{}),onClickRight:this.handleCloseColorPopup},void 0,n()(g.a,{sections:[u.r,u.p,u.b],context:{environment:this.environment,blocks:T.default.state.stores},onAccept:this.handleCloseColorPopup}))})})}renderTemplatesPopup(){const{device:e}=this.environment;return n()(S.a,{capture:this.stores.store.state.isTemplatesOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:()=>n()(M.c,{popupType:e.isMobile?M.c.PopupType.SlideUp:M.c.PopupType.Popup,open:this.stores.store.state.isTemplatesOpen,keepFocus:!0,render:()=>n()(y.b,{menuType:y.b.MenuType.Modal,title:n()(A.FormattedMessage,{defaultMessage:"Templates",id:"mobileActionBar.templates.modalTitle"}),right:n()(j.CancelMenuText,{}),onClickRight:this.handleCloseTemplatesPopup},void 0,n()(B.a,{type:B.a.Type.Vertical,store:this.stores.templatePickerMenuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onAccept:this.handleCloseTemplatesPopup,sections:[{key:"Basic",render:e=>n()(D.a,{},void 0,e.children),items:I.e.map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>n()(D.a,{title:n()(A.FormattedMessage,{defaultMessage:"Database",id:"mobileActionBar.databaseSection.title"})},void 0,e.children),items:I.a.filter(e=>e.shouldShow(this.environment)).map(this.renderPageTemplatePickerItem)},...P.b(this.environment,this.props.intl).map(e=>({key:e.name,render:t=>n()(D.a,{title:e.name},e.name,t.children),items:e.items.map(this.renderMobileTemplatePreviewItem)}))]}))})})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.stores.store.state.isOpen:this.shouldShow.state}}t.default=Object(A.injectIntl)(U)},tCjx:function(e,t,i){"use strict";i.r(t);var o=i("gcR/"),n=i.n(o),s=i("lSNA"),a=i.n(s),r=(i("3bBZ"),i("q1tI")),l=i("wldR"),c=i("MeYt"),d=i("FcJC"),h=i("mF3+"),u=i("QcDD"),m=i("ikHm"),p=i("4aFz"),b=i("id5p"),g=i("y6Dp"),y=i("CaJT"),v=i("HTFi"),S=i("3Z0Q");class f extends l.a{constructor(...e){super(...e),a()(this,"handleClickFind",()=>{p.c({environment:this.environment,analyticsFrom:"mobile-bottom-bar"}),g.Pe(this.environment,{itemName:"search"})}),a()(this,"handleClickQuickAdd",()=>{d.quickAddPage({environment:this.environment,from:"mobile_bottom_bar"}),g.Pe(this.environment,{itemName:"add_page"})}),a()(this,"handleUndo",()=>{y.f(this.environment,!0),g.Pe(this.environment,{itemName:"undo"})}),a()(this,"handleRedo",()=>{y.e(this.environment,!0),g.Pe(this.environment,{itemName:"redo"})}),a()(this,"canQuickAdd",this.createComputedStore(()=>Boolean(u.default.state.currentSpaceStore&&u.default.state.currentSpaceStore.canEdit())))}renderComponent(){var e;const t=v.a.state,i=this.environment.device.isPhone&&S.t(this.environment,this.props.store,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state);if(t&&!i){const{isTablet:e}=this.environment.device;return n()("div",{style:this.getWrapStyle(t)},void 0,e?this.renderTabletButtons():this.renderPhoneButtons())}}renderPhoneButtons(){return n()(r.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton())}renderTabletButtons(){return n()(r.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton(),this.renderUndoRedoButtons())}renderSearchButton(){return n()(c.a,{style:this.getSearchButtonStyle(),onClick:this.handleClickFind,mobileFeedback:!0},void 0,h.a.mobileBottomBarSearch(this.getIconStyle()))}renderUpdatesButton(){const{isTablet:e}=this.environment.device;return n()(b.a,{format:e?b.a.Format.MobileBottomBarTablet:b.a.Format.MobileBottomBarPhone})}renderQuickAddPageButton(){return n()(c.a,{style:this.getQuickAddButtonStyle(),onClick:this.handleClickQuickAdd,mobileFeedback:!0,disabled:!this.canQuickAdd.state,disabledFeedback:!0},void 0,h.a.mobileBottomBarAddPage(this.getIconStyle()))}renderUndoRedoButtons(){return n()(r.Fragment,{},void 0,n()(c.a,{style:this.getUndoButtonStyle(),onClick:this.handleUndo,mobileFeedback:!0,disabled:!y.b(),disabledFeedback:!0},void 0,h.a.mobileBottomBarUndo(this.getIconStyle())),n()(c.a,{style:this.getRedoButtonStyle(),onClick:this.handleRedo,mobileFeedback:!0,disabled:!y.a(),disabledFeedback:!0},void 0,h.a.mobileBottomBarRedo(this.getIconStyle())))}getWrapStyle(e){const{WindowSizeStore:t}=this.environment,{isTablet:i}=this.environment.device;return{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:i?"flex-start":"space-around",height:t.getSafePaddingBottomCSS(f.height),paddingBottom:t.state.paddingBottomCSS,background:this.theme.contentBackground,borderTop:"1px ".concat(this.theme.darkDividerColor," solid"),zIndex:m.k,opacity:e?1:0,pointerEvents:e?"auto":"none",cursor:"pointer"}}getSearchButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:1,paddingLeft:e.getSafePaddingLeftCSS(18),...t&&{flex:"none",paddingLeft:2,width:f.tabletButtonWidth,justifyContent:"center"}}}getQuickAddButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-end",flex:1,paddingRight:e.getSafePaddingRightCSS(18),...t&&{justifyContent:"center",flex:"none",paddingRight:0,width:f.tabletButtonWidth,marginRight:"auto"}}}getUndoButtonStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:"none",paddingLeft:e.getSafePaddingLeftCSS(18),width:f.tabletButtonWidth}}getRedoButtonStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",width:f.tabletButtonWidth,paddingRight:4}}getIconStyle(){return{width:26,fill:this.theme.regularTextColor}}}a()(f,"height",44),a()(f,"tabletButtonWidth",54),t.default=f}}]);